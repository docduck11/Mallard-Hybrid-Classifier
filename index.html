
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Game-farm Mallard Hybrid Classifier</title>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.png"/>
  <meta name="theme-color" content="#0b8a6a"/>
  <style>
    :root{ --bg:#0f172a; --card:#0b1320; --text:#e6edf3; --muted:#9aa4b2; --green:#0b8a6a; --ring:rgba(20,184,166,.45); }
    @media (prefers-color-scheme: light){ :root{ --bg:#f6f7f8; --card:#ffffff; --text:#0f172a; --muted:#6b7280; } }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#06101a,var(--bg) 240px) fixed;color:var(--text)}
    header{display:flex;align-items:center;gap:10px;background:linear-gradient(90deg,#0b8a6a,#116b94);padding:10px 14px;box-shadow:0 10px 32px rgba(0,0,0,.18)}
    header img{height:36px;width:auto;display:block}
    header .meta{display:flex;flex-direction:column;line-height:1.1}
    .title{font-weight:900;font-size:18px}
    .lab{font-size:12px;opacity:.9}
    .credit{margin-left:auto;font-size:11px;opacity:.85}
    main{max-width:960px;margin:14px auto 40px;padding:0 14px}
    .card{background:var(--card);border-radius:18px;padding:18px;border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .grid{display:grid;gap:14px} @media(min-width:860px){.grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:repeat(3,1fr)}}
    .label{font-weight:700;font-size:14px;margin-bottom:6px;color:#cdebea}
    .segment{display:inline-flex;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.12)}
    .segment button{padding:10px 16px;border:none;background:transparent;color:var(--text);cursor:pointer;min-width:110px}
    .segment button.active{background:rgba(20,184,166,.18)}
    .input{display:flex;flex-direction:column;gap:6px}
    input[type=number]{width:100%;padding:14px;border-radius:12px;border:1px solid rgba(148,163,184,.45);background:rgba(255,255,255,.04);color:var(--text);font-size:18px}
    input::placeholder{color:#94a3b8}
    input:focus{outline:3px solid var(--ring);border-color:transparent}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(148,163,184,.15);border:1px solid rgba(148,163,184,.35);font-size:12px;margin-left:6px;color:#cbd5e1}
    .btns button{border:none;border-radius:14px;padding:14px 18px;font-size:18px;font-weight:800;cursor:pointer}
    .btn-primary{background:linear-gradient(180deg,#129b7a,#0b6a4f);color:#fff;box-shadow:0 10px 24px rgba(11,138,106,.35)}
    .btn-secondary{background:linear-gradient(180deg,#334155,#1f2937);color:#e5e7eb}
    .result{margin-top:12px;border-radius:16px;padding:14px 16px;font-size:22px;font-weight:900;display:flex;justify-content:space-between;align-items:center}
    .result.ok{background:linear-gradient(180deg,rgba(16,185,129,.18),rgba(16,185,129,.08));border:1px solid rgba(16,185,129,.28);color:#10e7a6}
    .result.warn{background:linear-gradient(180deg,rgba(242,193,0,.18),rgba(242,193,0,.08));border:1px solid rgba(242,193,0,.28);color:#ffd166}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .kpi .box{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 12px;font-size:14px}
    #resultIcon{margin-top:8px;display:flex;align-items:center;gap:10px}
    #resultIcon img{height:48px;width:auto;display:block}
    footer{text-align:center;color:var(--muted);font-size:12px;margin-top:18px}
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Mallard badge"/>
    <div class="meta">
      <div class="title">Game-farm Mallard Hybrid Classifier</div>
      <div class="lab">SUNY ESF Waterfowl and Wetlands Lab</div>
    </div>
    <div class="credit">Created by Dominic Hockenbury</div>
  </header>
  <main>
    <div class="card">
      <div class="grid grid-2">
        <div>
          <div class="label">Sex</div>
          <div class="segment" id="sexSeg">
            <button data-sex="female" class="active">Female</button>
            <button data-sex="male">Male</button>
          </div>
        </div>
        <div>
          <div class="label">Mode <span class="pill">Balanced œÑ</span></div>
          <div class="small">Predictions use the balanced threshold (œÑ). Works offline.</div>
        </div>
      </div>
      <div id="inputs" class="grid grid-3" style="margin-top:14px"></div>
      <div class="grid grid-2 btns" style="margin-top:12px">
        <button id="classify" class="btn-primary">Classify</button>
        <button id="reset" class="btn-secondary">Reset</button>
      </div>
      <div id="out">
        <div id="call" class="result" style="text-align:center; justify-content:center" style="display:none"></div>
        <div id="resultIcon" style="justify-content:center; text-align:center"></div>
        <div class="kpi">
          <div class="box">p (raw): <b id="pval">‚Äî</b></div>
          <div class="box">œÑ (raw): <b id="tau">‚Äî</b></div>
          <div class="box">z: <b id="zval">‚Äî</b></div>
        </div>
        <div class="small" style="margin-top:8px">Rule: predict Likely &lt; 70% Wild Mallard Ancestry when p ‚â• œÑ.</div>
      </div>
    </div>
    <footer>Standardized logistic models ‚Ä¢ sex-specific ‚Ä¢ locally computed.<br/><span style=\"display:block; margin-top:8px; font-size:12px; color:#9aa4b2;\">Disclaimer: This tool is a work in progress and classification results may not be fully accurate.</span>
<br/><span style="display:block; margin-top:8px; font-size:12px; color:#9aa4b2;">
‚ö†Ô∏è <b>Disclaimer:</b><br/>
This tool is still under development. Based on current tests:<br/>
- For <b>drakes (males):</b> about <b>67%</b> of those with &lt;70% wild mallard ancestry are correctly classified, and about <b>83%</b> of those with ‚â•70% ancestry are correctly classified.<br/>
- For <b>hens (females):</b> classification is highly accurate, with <b>100%</b> of &lt;70% ancestry hens and about <b>97%</b> of ‚â•70% ancestry hens correctly classified.<br/><br/>
Results may change as more data are added and models are refined.
</span>
</footer>
  
    <div class="card" style="margin-top:16px">
      <div class="label">Measurement Demo (Placeholder)</div>
      <div class="small" style="margin-bottom:8px">
        This app works offline. When you're ready, add <code>measurement_demo.mp4</code> to the app folder and it will play here without internet.
      </div>
      <video id="measureDemo" width="320" height="240" controls style="display:block; margin:10px auto; background:rgba(255,255,255,.06); border-radius:12px; border:1px solid rgba(148,163,184,.25)">
        <!-- Add the local video file to enable offline playback -->
        <!-- <source src="measurement_demo.mp4" type="video/mp4"> -->
        Your browser does not support the video tag.
      </video>
    </div>

  </main>
<script>
const MODELS = {"female": {"b0": -5.4465, "features": [{"key": "tarsus2", "label": "Tarsus 2 (mm)", "mean": 43.984, "std": 2.1848, "coef": 1.2293, "min": 39, "max": 55, "step": 0.1, "unit": "mm"}, {"key": "wing", "label": "Wing Chord (cm)", "mean": 262.3024, "std": 11.5849, "coef": -1.2384, "min": 150, "max": 350, "step": 1, "unit": "cm"}], "tau": 0.0689}, "male": {"b0": -3.4072, "features": [{"key": "tarsus2", "label": "Tarsus 2 (mm)", "mean": 46.4819, "std": 2.1641, "coef": 0.7743, "min": 39, "max": 55, "step": 0.1, "unit": "mm"}, {"key": "wing", "label": "Wing Chord (cm)", "mean": 283.0392, "std": 10.5121, "coef": -0.8025, "min": 150, "max": 350, "step": 1, "unit": "cm"}, {"key": "culmen", "label": "Culmen Width (mm)", "mean": 22.271, "std": 0.865, "coef": 0.3941, "min": 17.0, "max": 25.0, "step": 0.1, "unit": "mm"}], "tau": 0.0738}};

const sexSeg = document.getElementById('sexSeg');
const inputsBox = document.getElementById('inputs');
const btnClassify = document.getElementById('classify');
const btnReset = document.getElementById('reset');

function renderInputs(sex){
  inputsBox.innerHTML = '';
  MODELS[sex].features.forEach(function(f){
    var id = sex + '-' + f.key;
    var unit = f.unit || '';
    var wrap = document.createElement('div');
    wrap.className = 'input';
    wrap.innerHTML =
      '<div class="label">' + f.label + ' <span class="pill">' + f.min + '‚Äì' + f.max + ' ' + unit + '</span></div>' +
      '<input type="number" step="' + f.step + '" min="' + f.min + '" max="' + f.max + '" inputmode="decimal" id="' + id + '" placeholder="' + f.min + ' ‚Äì ' + f.max + '">';
    inputsBox.appendChild(wrap);
  });
}

function getVals(sex){
  var vals = [];
  for (var i=0; i<MODELS[sex].features.length; i++){
    var f = MODELS[sex].features[i];
    var el = document.getElementById(sex + '-' + f.key);
    var v = parseFloat(el.value);
    if (isNaN(v)) return null;
    vals.push(v); // no conversion; using entered cm for wing
  }
  return vals;
}

function classify(sex){
  var model = MODELS[sex];
  var vals = getVals(sex);
  if (!vals) return;
  var z = model.b0;
  for (var i=0; i<model.features.length; i++){
    var f = model.features[i];
    var xstd = (vals[i] - f.mean) / f.std;
    z += f.coef * xstd;
  }
  var p = 1/(1+Math.exp(-z));
  var tau = model.tau;
  var callBox = document.getElementById('call');
  var isLess = (p >= tau); // predict <70% when p >= tau
  callBox.className = 'result ' + (isLess ? 'ok' : 'warn');
  callBox.textContent = isLess ? 'Likely < 70% Wild Mallard Ancestry' : 'Likely ‚â• 70% Wild Mallard Ancestry';
  callBox.style.display = 'flex';
  document.getElementById('pval').textContent = p.toFixed(4);
  document.getElementById('tau').textContent = tau.toFixed(4);
  document.getElementById('zval').textContent = z.toFixed(4);

  var icon = document.getElementById('resultIcon');
  icon.innerHTML = '';
  if (isLess) {
    var img = document.createElement('img');
    img.src = 'duck_tractor.png';
    img.alt = 'tractor mallard';
    img.style.width = '60px';
    img.style.height = '60px';
    icon.appendChild(img);
  } else {
    var span = document.createElement('span');
    span.textContent = 'ü¶Ü';
    span.style.fontSize = '48px';
    icon.appendChild(span);
  }
}
function currentSex(){ return sexSeg.querySelector('button.active').dataset.sex; }

sexSeg.addEventListener('click', function(e){
  if (e.target.tagName !== 'BUTTON') return;
  sexSeg.querySelectorAll('button').forEach(function(b){ b.classList.remove('active'); });
  e.target.classList.add('active');
  renderInputs(e.target.dataset.sex);
  document.getElementById('call').style.display='none';
  document.getElementById('resultIcon').innerHTML='';
  document.getElementById('pval').textContent='‚Äî';
  document.getElementById('tau').textContent='‚Äî';
  document.getElementById('zval').textContent='‚Äî';
});

btnClassify.addEventListener('click', function(){ classify(currentSex()); });
btnReset.addEventListener('click', function(){
  renderInputs(currentSex());
  document.getElementById('call').style.display='none';
  document.getElementById('resultIcon').innerHTML='';
  document.getElementById('pval').textContent='‚Äî';
  document.getElementById('tau').textContent='‚Äî';
  document.getElementById('zval').textContent='‚Äî';
});

inputsBox.addEventListener('input', function(){ classify(currentSex()); });

document.addEventListener('DOMContentLoaded', function(){
  renderInputs('female');
  if ('serviceWorker' in navigator) navigator.serviceWorker.register('./service-worker.js');
});
</script>
</body>
</html>
