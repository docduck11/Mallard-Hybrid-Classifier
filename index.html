<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game-farm Mallard Hybrid Classifier</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b8a6a">
  <style>
    :root {
      --bg: #0a121d;
      --panel: #0f1b2b;
      --ink: #e6edf3;
      --muted: #9aa4b2;
      --pill: #152538;
      --accent: #1fa971;
      --btn2: #2d3a4e;
      --outline: #1d2a3b;
      --success-ink: #7cf0b0;
      --success-bg: #0b1f18;
      --success-border: #1a704f;
    }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; }
    .topbar { background:#0b8a6a; display:flex; align-items:center; justify-content:space-between; padding:10px 16px; }
    .brand { display:flex; align-items:center; gap:10px; }
    .brand img { width:32px; height:32px; border-radius:999px; }
    .brand .title { font-weight:800; }
    .brand .sub { font-size:12px; color:#e9fff8; opacity:.85 }
    .credit { color:#d8f2ef; opacity:.8; font-size:12px; }
    .wrap { max-width:1024px; margin:24px auto; padding:0 16px 32px; }
    .panel { background:var(--panel); border-radius:18px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.3);}
    .grid { display:grid; gap:14px; }
    .grid-2 { grid-template-columns:1fr 1fr; }
    .seg { display:inline-grid; grid-auto-flow:column; background:#0b1420; padding:4px; border-radius:12px; }
    .seg input { display:none; }
    .seg label { padding:8px 14px; border-radius:10px; cursor:pointer; color:#a9b4c1; }
    .seg input:checked + label { background:#11273e; color:var(--ink); }
    .label { color:#cdd6e3; font-size:14px; margin-bottom:6px; display:flex; align-items:center; gap:8px; }
    .pill { font-size:12px; color:#cdd6e3; background:var(--pill); padding:2px 8px; border-radius:999px; }
    input[type=number] { width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--outline); background:#0b1420; color:var(--ink); }
    .btns button { width:100%; padding:14px 16px; border:0; border-radius:14px; font-weight:700; cursor:pointer; }
    .btn-primary { background:var(--accent); color:white; }
    .btn-secondary { background:var(--btn2); color:#cfd8e3; }
    .mini { background:#0b1420; border-radius:12px; padding:10px 12px; color:#cdd6e3; }
    .err { margin-top:10px; color:#f87171; font-weight:700; display:none; }
    .call { display:none; margin-top:14px; background:var(--success-bg); border:1px solid var(--success-border); color:var(--success-ink); border-radius:12px; padding:14px; text-align:center; font-weight:800; }
.call.yellow {
  background: #3a3200 !important;      /* dark yellowish background */
  border: 1px solid #e6c400 !important; /* yellow border */
  color: #ffe76c !important;           /* yellow text */
}
    .call .row { display:flex; align-items:center; gap:12px; justify-content:center; }
    .call img { width:48px; height:48px; }
    .disc { text-align:center; color:#a9b4c1; font-size:12px; margin:14px 0; }
    .disc strong { color:#ffd166; }
    .card { background:var(--panel); border-radius:14px; padding:14px; border:1px solid rgba(255,255,255,.05); }
    .card h3 { margin:0 0 10px; font-size:16px; color:#cfe2ff; }
    .video-wrap { display:flex; justify-content:center; padding:10px; }
    video { max-width:560px; width:100%; border-radius:10px; outline:1px solid rgba(255,255,255,.06); }
    ul.materials { margin:8px 0 0 18px; }
    .footer { text-align:center; color:#9aa4b2; font-size:11px; margin-top:20px; }
    @media (max-width:720px){ .grid-2{ grid-template-columns:1fr; } }
  </style>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <img src="logo.png" alt="SUNY ESF logo">
      <div>
        <div class="title">Game‚Äëfarm Mallard Hybrid Classifier</div>
        <div class="sub">SUNY ESF Waterfowl and Wetlands Lab</div>
      </div>
    </div>
    <div class="credit">Created by Dominic Hockenbury</div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="grid grid-2" style="align-items:start">
        <div>
          <div class="label" style="margin-bottom:8px">Sex</div>
          <div class="seg">
            <input id="sex-f" name="sex" type="radio" value="female" checked />
            <label for="sex-f">Female</label>
            <input id="sex-m" name="sex" type="radio" value="male" />
            <label for="sex-m">Male</label>
          </div>
        </div>
        <div>
          <div class="label" style="margin-bottom:8px">Mode <span class="pill">Balanced œÑ</span></div>
          <div style="color:#a9b4c1;font-size:13px">Predictions use the balanced threshold (œÑ). Works offline.</div>
        </div>
      </div>

      <div class="grid grid-2" style="margin-top:14px">
        <div>
          <div class="label">Tarsus 2 (mm) <span class="pill">39‚Äì55 mm</span></div>
          <input id="tarsus2" type="number" step="0.1" min="39" max="55" placeholder="39 ‚Äì 55">
        </div>
        <div>
          <div class="label">Wing chord (mm) <span class="pill">200‚Äì350 mm</span></div>
          <input id="wing" type="number" step="1" min="200" max="350" placeholder="200 ‚Äì 350">
        </div>
        <div id="male-bw-wrap" style="display:none">
          <div class="label">Bill width (mm) <span class="pill">mm</span></div>
          <input id="billwidth" type="number" step="0.1" min="10" max="40" placeholder="e.g., 24">
        </div>
      </div>

      <div class="grid grid-2 btns" style="margin-top:16px">
        <button class="btn-primary" onclick="try{ classify(currentSex()); }catch(e){ console.error(e); }">Classify</button>
        <button class="btn-secondary" onclick="(function(){
          const box = document;
          box.querySelectorAll('input').forEach(i => { if (i.type==='number') i.value=''; });
          hideErr(); const call = document.getElementById('call'); if (call) call.style.display='none';
          setMini('pval','‚Äî'); setMini('tau','‚Äî'); setMini('zval','‚Äî');
          const img=document.getElementById('resultImg'); if (img) img.src='';
        })();">Reset</button>
      </div>

      <div id="err" class="err">‚ùå Please enter all measurements in millimeters (mm). Values under 50 mm are not valid for wing chord.</div>

      <div class="grid grid-2" style="margin-top:14px">
        <div class="mini">p (raw): <span id="pval">‚Äî</span></div>
        <div class="mini">œÑ (raw): <span id="tau">‚Äî</span></div>
        <div class="mini">z: <span id="zval">‚Äî</span></div>
      </div>

      <div id="call" class="call" aria-live="polite">
        <div class="row">
          <img id="resultImg" alt="" src="">
          <div class="call-text">‚Äî</div>
        </div>
      </div>

      <div class="sub" style="margin-top:10px">Rule: predict Likely &lt; 70% Wild Mallard Ancestry when p ‚â• œÑ.</div>
    </div>

    <div class="disc">
      <div>Standardized logistic models ¬∑ sex‚Äëspecific ¬∑ locally computed.</div>
      <div style="margin-top:8px"><strong>‚ö† Disclaimer:</strong> This tool is a work in progress and classification results may not be fully accurate.</div>
      <div style="margin-top:6px">
        ‚Äì For drakes (males): about 67% of those with &lt;70% wild mallard ancestry are correctly classified, and about 83% of those with ‚â•70% ancestry are correctly classified.<br/>
        ‚Äì For hens (females): classification is highly accurate, with 100% of &lt;70% ancestry hens and about 97% of ‚â•70% ancestry hens correctly classified.
      </div>
      <div style="margin-top:6px">Results may change as more data are added and models are refined.</div>
    </div>

    <div class="card" style="margin:14px 0 16px">
      <h3>Measurement Demo</h3>
      <div class="video-wrap">
        <video controls poster="logo.png" preload="metadata">
          <source src="measurement_demo.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
    </div>

    <div class="card">
      <h3>Materials Needed</h3>
      <ul class="materials">
  <li>
    Digital calipers ‚Äî
    <a href="https://www.amazon.com/Digital-Caliper-Electronic-Micrometer-Millimeter/dp/B087N5N45G/ref=sr_1_1_sspa?crid=MN7X4Y7XGMZN&dib=eyJ2IjoiMSJ9.kk-u632s2ZagricKeqCkzXd5x66bd9cqgX2kUQr_YZAzzuonOSM84kpG0ECUl-AhkFHKtvWY_ELeM52jzepywv0Q3Wx7jtzZcez83bZ2WI3c4QkPo9TqY1_bu5yI9wtv_U1t0Hp9fo7lt01b0RDpn2OgG3z6X3uQfuDYM0IKzaChtBBg-CnHEIFdTFPKUPG1D_vyI2X6Gf0LViw-AeSWuhfLWAfCFdb2iy_Zo0G3y_M.GW0RSLd-9HO2pM1gv0e4g1Kt8GoXWeHy7H5EMbJTHXk&dib_tag=se&keywords=calipers&qid=1759862504&sprefix=calip%2Caps%2C122&sr=8-1-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&th=1"
       target="_blank" rel="noopener noreferrer">Amazon link</a>
  </li>
  <li>
    Meter stick in cm ‚Äî
    <a href="https://www.amazon.com/Pacific-Arc-Stainless-Measurements-Inches/dp/B074D1BK4M/ref=sr_1_3_sspa?crid=2V3J2UUONMGKM&dib=eyJ2IjoiMSJ9.T-1BtX8Jvp1G8mpeE-LNO4hxyM0trV0k0Hnm3S5ok3HnZM1LkpVeMcAw_t5zRUFKi1Cm2Uyq2nWNVCd0qjSi9gtdW5US6_d2dtDLt5cN4fU63h71KL1JuYBpLk7rnBGXej5C4oHeexMEax8bf7JCYu4fLLgXv7Rxyc5LUxHGzNgY9iv0KH-Zv_X7AfR4-wqjqbfI1jFh-06TwnZ5z6iEOGcjguX_r2Lia-RDuehednMjlig6SngdZ19IMdsThZcIjALmUj32nbDC8rF6T6SKTBocJT6fkxMuQl6pO3jqgxQ.lnD-2lJjHjlR0LxiNI_3Vq_sTudrW3zteMfzh5QFyKY&dib_tag=se&keywords=meter%2Bstick%2Bcm&qid=1759862340&sprefix=%2Caps%2C103&sr=8-3-spons&sp_csd=d2lkZ2V0TmFtZT1zcF9hdGY&th=1"
       target="_blank" rel="noopener noreferrer">Amazon link</a>
  </li>
</ul>
    </div>

    <div class="footer">mallard app <strong>v9.9 full UI</strong> ‚Äî 2025-10-07 18:08</div>
  </div>

  <script>
    function currentSex(){ return document.querySelector('input[name="sex"]:checked')?.value || 'female'; }
    function showErr(msg){ const e=document.getElementById('err'); if(!e) return; e.textContent=msg; e.style.display='block'; }
    function hideErr(){ const e=document.getElementById('err'); if(!e) return; e.style.display='none'; e.textContent=''; }
    function setMini(id,val){ const el=document.getElementById(id); if(el) el.textContent = val; }
    function syncMaleField(){ const wrap = document.getElementById('male-bw-wrap'); if (wrap) wrap.style.display = (currentSex()==='male')?'':'none'; }
    document.addEventListener('DOMContentLoaded', syncMaleField);
    document.querySelectorAll('input[name="sex"]').forEach(r => r.addEventListener('change', syncMaleField));

    function classify(sex){
  sex = sex || currentSex();

  const t  = parseFloat(document.getElementById('tarsus2')?.value);
  const w  = parseFloat(document.getElementById('wing')?.value);
  const bw = parseFloat(document.getElementById('billwidth')?.value);

  // basic input checks
  if (isNaN(t) || isNaN(w) || (sex === 'male' && isNaN(bw))) {
    showErr('‚ùå Please enter all measurements (including bill width for males).');
    return;
  }
  if (!isNaN(w) && w < 50) {
    showErr('‚ùå Please enter all measurements in millimeters (mm). Values under 50 mm are not valid for wing chord.');
    return;
  }
  hideErr();

  // Models: females = 2 features (tarsus2, wing)
  //         males   = 3 features (tarsus2, wing, culmen/bill width)
  const M = {
    female: {
      b0: -5.4465,
      tau: 0.0350,  // field-liberal œÑ for hens
      feats: [
        { mean: 43.9840, std:  2.1848, coef:  1.2293 }, // tarsus2
        { mean: 262.3024, std: 11.5849, coef: -1.2384 } // wing
      ]
    },
    male: {
      b0: -3.4859,
      tau: 0.1100,  // field-liberal œÑ for drakes with bill width
      feats: [
        { mean: 46.5156, std:  2.1905, coef:  0.9289 }, // tarsus2
        { mean: 282.8753, std: 10.6929, coef: -0.9525 }, // wing
        { mean: 22.2789, std:  0.8656, coef:  0.4753 }  // culmen (bill) width
      ]
    }
  };

  const m = M[sex];

  // choose inputs per sex
  const inputs = (sex === 'male') ? [t, w, bw] : [t, w];

  // logistic model: z = b0 + Œ£ coef * ((x - mean) / std)
  let z = m.b0;
  for (let i = 0; i < m.feats.length; i++) {
    const f = m.feats[i];
    const x = inputs[i];
    z += f.coef * ((x - f.mean) / f.std);
  }

  const p = 1 / (1 + Math.exp(-z));

  setMini('pval', isFinite(p) ? p.toFixed(4) : '‚Äî');
  setMini('tau',  m.tau.toFixed(4));
  setMini('zval', isFinite(z) ? z.toFixed(4) : '‚Äî');

const call   = document.getElementById('call');
const icon   = document.getElementById('resultImg');
const textEl = call ? call.querySelector('.call-text') : null;

  const isLT = (p >= m.tau);
  const txt  = isLT
    ? 'Likely < 70% Wild Mallard Ancestry'
    : 'ü¶Ü Likely ‚â• 70% Wild Mallard Ancestry';

  if (call) {
    call.style.display = 'block';

    // update text in the inner .call-text span
    if (textEl) {
      textEl.textContent = txt;
    } else {
      // fallback if .call-text not found
      call.textContent = txt;
    }

    // reset classes
    call.classList.remove('yellow');

    // apply yellow style when <70% wild
    if (isLT) {
      call.classList.add('yellow');
    }
  }

  // update icon
  if (icon) {
  if (isLT) {
    icon.style.display = 'inline-block';
    icon.src = 'duck_tractor.png';
  } else {
    icon.style.display = 'none';   // hide icon completely for ‚â•70%
    icon.src = '';                 // clear image source
  }
}
}

    
  </script>

  <script>
    const APP_VERSION = "v1.0.1";
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js?v=' + APP_VERSION)
          .then(function(reg) { /* ok */ })
          .catch(function() { /* ignore */ });

        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', function() {
          if (refreshing) return;
          refreshing = true;
          window.location.reload();
        });
      });
    }
  </script>
</body>
</html>
